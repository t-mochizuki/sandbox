---
layout: post
title: モジュールとDI
date: 2016-01-11 00:00:00
---

## まえがき

『AngularJSリファレンス』(池添明宏、金井健一、吉田徹生[共著])を読んでいます。

AngularJSの特徴的な機能にテンプレートエンジン、ディレクティブ、双方向バインディング、コントローラとスコープ、DIコンテナがあります。

- テンプレートエンジン
- ディレクティブ
- 双方向バインディング
- コントローラとスコープ
- DIコンテナ

ここでは「Chapter 05 モジュールとDI」についてまとめてみたいと思います。

## モジュールとは？

モジュールとは、関数やオブジェクトをグループ化して管理する仕組みのことです。

モジュール機能を利用することで、名前の衝突が発生しにくくなり、部品の再利用性も向上します。

## モジュール作成

APIの細かいところは省略して、サンプルコードのみを記載します。

```js
var app = angular.module('app', []);
```

## モジュール取得

APIの細かいところは省略して、サンプルコードのみを記載します。

```js
var app = angular.module('app');
```

## モジュールへのサービスの登録

モジュールに部品を登録するメソッドは下記になります。

- Module#value
- Module#constant
- Module#factory
- Module#service
- Module#provider
- Module#controller
- Module#filter
- Module#directive
- Module#animation
- Module#run
- Module#config

APIの詳細は「Chapter 09 カスタムサービス」にあります。

### Module#value

モジュールに関数やオブジェクト(下記ではオプジェクトと省略します。)を登録する関数です。

第1引数に名前を渡し、第2引数にオブジェクトを渡します。

直接、オブジェクトを渡すので、DIで他のサービスをインジェクトできません。

Module#valueの役割はModule#constantの役割とほぼ同じです。

コントローラやサービスで値を共有したい場合にModule#valueを利用するとのことです。

### Module#constant

モジュールにオブジェクトを登録する関数です。

第1引数に名前を渡し、第2引数にオブジェクトを渡します。

直接、オブジェクトを渡すので、DIで他のサービスをインジェクトできません。

ディレクティブやプロバイダのコンフィギュレーションにModule#constantを利用するとのことです。

### Module#factory

カスタムサービスを登録する関数です。

DIで他のサービスをインジェクトして利用するサービスを作成するために利用します。

第1引数に名前を渡し、第2引数にオブジェクトを返す関数を渡します。

基本的にサービスはシングルトンなのですが、Module#factoryを利用して、新しいインスタンスを生成するサービスを実装することができます。

### Module#service

カスタムサービスを登録する関数です。

DIで他のサービスをインジェクトして利用するサービスを作成するために利用します。

第1引数に名前を渡し、第2引数にコンストラクタ関数を渡します。

他のサービスやコントローラから利用された際に1度だけnewでインスタンスが生成されます。

### Module#provider

プリミティブな機能という印象。

第1引数に名前を渡し、第2引数に$getメソッドを持ったオブジェクトを返す関数かコンストラクタ関数を渡します。

### Module#controller

カスタムコントローラを登録する関数です。

第1引数に名前を渡し、第2引数にコンストラクタ関数を渡します。

### Module#filter

カスタムフィルターを登録する関数です。

第1引数に名前を渡し、第2引数にオブジェクトを返す関数を渡します。

### Module#directive

カスタムディレクティブを登録する関数です。

第1引数に名前を渡し、第2引数にオブジェクトを返す関数を渡します。

### Module#animation

知りません。

### Module#run

すべてのモジュールの読み込みが完了した後に呼び出される。

DOM解析後に初期化処理を行いたい場合に利用するとのこと。

### Module#config

サービスのインスタンスが生成される前に呼び出される。

ディレクティブやプロバイダのコンフィギュレーションだと思う。

## 依存関係の定義

APIの細かいところは省略して、サンプルコードのみを記載します。

```js
var app = angular.module('app', ['ui.select']);
```

appモジュールからui.selectモジュールの部品が利用可能になります。

## あとがき

モジュールにサービスを登録するメソッドが主な内容になります。

引数でオブジェクトを渡すもの、オブジェクトを返す関数を渡すもの、コンストラクタ関数を渡すものがありました。

コンストラクタ関数を渡すものはModule#serviceとModule#controllerです。(Module#providerを無視すれば)

直接オブジェクトを渡すものはModule#valueとModule#constantです。

それ以外は、大体、オブジェクトを返す関数を渡すものです。(Module#runとModule#configを無視すれば)

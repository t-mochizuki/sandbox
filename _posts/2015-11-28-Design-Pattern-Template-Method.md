---
layout: post
title: Template Method Pattern
date: 2015-11-28 00:00:00
---

## まえがき

『Rubyによるデザインパターン』を読んでいます。

大まかな流れは、第１章でメタパターンを学び、第２章でRubyを学び、第３章から第１５章でデザインパターンを学び、第１６章でDSL(ドメイン特化言語)を学び、第１７章でメタプログラミングを学び、第１８章でCoC(Convention over Configuration)を学ぶという流れです。後半は読んでいない状態です。

メタパターンとテンプレートメソッドを確認してみたいと思います。

## メタパターン

メタパターンはパターンのパターンです。

メタパターンは４つあります。

- 変わるものと変わらないものを分離する
- インタフェースに対してプログラムし、実装に対して行わない
- 継承より集約
- 委譲、委譲、委譲

テンプレートメソッド、ファクトリメソッドは`変わるものと変わらないものを分離する`に関連するパターンです。

ストラテジー、アブストラクトファクトリは`委譲、委譲、委譲`に関連するパターンです。

`インタフェースに対してプログラムし、実装に対して行わない`と`継承より集約`は全てのパターンに関連するパターンだと思います。

`継承より集約`の大まかな解説があります。

継承のメリットはスーパークラスの実装をサブクラスで再利用できることですが、スーパークラスの実装をサブクラスで再利用する(使用する)と、スーパークラスとサブクラスは密結合になってしまいます。

つまり、スーパークラスの実装を変更すると、サブクラスの振る舞いが変わってしまいます。

目標が疎結合なシステムであれば、スーパークラスの実装を再利用することは密結合というデメリットを生じさせてしまいます。

一方、集約は継承のメリットを持ちながら、継承のデメリットを持ちません。だから、`継承より集約`という結論のようです。(もちろん、集約にも何かしらのコストはあるはずです。)

継承を絶対悪だと勘違いしやすいのですが、継承は絶対悪ではありません。ほとんどのパターンに継承が使われます。

## テンプレートメソッド

まず、文字列の長さなどを制限するような課題をテンプレートメソッドを使って実装してみます。

{% gist t-mochizuki/246c953e2aa6302b5259 %}

`変わるものと変わらないものを分離する`に従っています。

次に、フックメソッドを使って実装してみます。

フックメソッドとはサブクラスでオーバーライドできる非抽象メソッドのことです。

{% gist t-mochizuki/89d3f598048bb9de85de %}

この場合はあまりご利益がありません。

最後に、traitに処理をまとめてみます。

{% gist t-mochizuki/c8fa0b8bc93d894e0764 %}

DRY原則に従っています。

## あとがき

メタパターンとテンプレートメソッドを確認しました。

`変わるものと変わらないものを分離する`に従うべきか、DRY原則に従うべきか悩ましいところですが、仕様が変わらないということであればDRY原則に従うべきかなと思います。
